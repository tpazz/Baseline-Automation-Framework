#!/usr/bin/env bash
set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" &> /dev/null && pwd)"

# ---------- Java -------------------------------------------------------------
export JAVA_HOME="$SCRIPT_DIR/src/test/resources/jdks/linux"
export PATH="$JAVA_HOME/bin:$PATH"

# ---------- Gradle -----------------------------------------------------------
export GRADLE_USER_HOME="$SCRIPT_DIR/.gradle"     # <— lives beside the script

echo "DEBUG: JAVA_HOME is set to $JAVA_HOME"
echo "DEBUG: Which java: $(which java)"
java -version

# ---------- Driver binaries --------------------------------------------------
for f in \
  "$SCRIPT_DIR/src/test/resources/webdriver/linux/chromedriver-linux64/chromedriver" \
  "$SCRIPT_DIR/src/test/resources/webdriver/linux/edgedriver-linux64/msedgedriver" \
  "$SCRIPT_DIR/src/test/resources/webdriver/linux/geckodriver-linux64/geckodriver"
do
  if [ -f "$f" ]; then
    chmod +x "$f"
  else
    echo "DEBUG: $f not found – skipping chmod"
  fi
done

# ---------- Run Gradle --------------------------------------------------------
chmod +x "$SCRIPT_DIR/gradlew"
"$SCRIPT_DIR/gradlew" "$@"
